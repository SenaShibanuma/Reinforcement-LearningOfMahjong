コード構造設計
このドキュメントは、本プロジェクトにおけるソースコードのディレクトリ構造と、各ファイルの役割を定義する。

1. 基本方針
ソースコードはすべて src ディレクトリ内に配置する。各機能は、以下の3つの主要な責務に分割し、それぞれ対応するパッケージ（ディレクトリ）で管理する。

env (環境): 麻雀のゲーム進行を管理する。

agent (エージェント): AIの思考と行動選択を担当する。

utils (ユーティリティ): 上記2つを補助する、データ変換などの共通機能。

2. ファイル構成
src/
├── constants.py           # プロジェクト全体で使う定数を定義 (ベクトル次元など)
|
├── agent/
│   ├── __init__.py
│   ├── agent.py           # AIエージェント本体。モデルを保持し、行動を決定する。
│   └── model.py           # KerasのTransformerモデルを構築する関数を定義。
|
├── env/
│   ├── __init__.py
│   └── mahjong_env.py     # 麻雀のルールと状態遷移を管理する「環境」クラス。
|
└── utils/
    ├── __init__.py
    ├── parser.py          # 天鳳形式のログを解析し、ゲームの状態を追跡するパーサークラス。
    └── vectorizer.py      # ゲームの状態や選択肢をモデル入力用のベクトルに変換する関数群。

3. 各ファイルの役割詳細
constants.py
MAX_CONTEXT_LENGTH や VECTOR_DIM など、モデルの形状やベクトル化の仕様に関わる固定値を一元管理する。

agent/model.py
train_transformer.py 内にあった Keras のモデル構築ロジックを分離。純粋にモデルの構造定義に責務を持つ。

agent/agent.py
強化学習における「エージェント」を表現するクラス。

学習済みの model をインスタンスとして保持する。

env から観測（コンテキストと選択肢）を受け取る。

utils.vectorizer を使って観測をベクトル化する。

model に入力し、推論結果（各選択肢のスコア）を得る。

スコアを元に行動を決定し、env に返す。

utils/parser.py
提供された transformer_parser.py の TransformerParser クラスを配置。このクラスは天鳳のログ形式を解釈し、詳細なゲームイベントを生成する強力な機能を持つため、環境を実装する上での中核的な部品となる。

utils/vectorizer.py
提供された vectorizer.py のベクトル化関数 (vectorize_event, vectorize_choice) を配置。AIモデルと人間の理解できるゲーム状態との間の「翻訳機」の役割を担う。

env/mahjong_env.py
強化学習の標準的なインターフェース（reset, stepなど）を持つクラスを定義する。

utils.parser を内部で利用して、麻雀の1局をシミュレーションする。

step メソッドは、エージェントから受け取った行動をゲームに反映させ、次の状態、報酬、ゲーム終了フラグなどを返す。

このファイルの具体的な実装が、フェーズ1の後半における中心的なタスクとなる。